# 📘 Payzme 포인트 → Payzme 토큰 스왑 서비스 설계

## 🎯 목적

사용자가 Payzme 플랫폼에서 적립한 포인트를 Payzme 토큰(ERC-20)으로 안전하게 스왑(전환)할 수 있는 서비스 제공.

---

## 🧱 기본 구성요소

| 요소            | 설명                                                      |
|-----------------|-----------------------------------------------------------|
| 포인트 시스템   | 사용자별 적립 포인트(오프체인, DB 관리)                   |
| 스왑 요청       | 사용자가 포인트를 토큰으로 전환 요청                      |
| 인증            | Web3Auth 기반 유저 인증 및 지갑 주소 확보                 |
| 스왑 처리       | 백엔드에서 스왑 요청을 큐/Job으로 분산 처리                |
| 토큰 전송       | 서버 지갑에서 Payzme 토큰(ERC-20) 전송                    |
| 트랜잭션 기록   | 스왑 내역, Tx hash, 포인트 차감 등 DB 기록                |

---

## ⚙️ 서비스 흐름

1. 사용자가 로그인 후 포인트 잔액 확인
2. "스왑하기" 버튼 클릭 및 스왑 요청
3. Web3Auth로 유저 인증 및 지갑 주소 확보
4. 백엔드에서 포인트 보유량 확인 및 차감
5. 스왑 요청을 Job Queue로 전송(비동기 처리)
6. Worker가 서버 지갑에서 Payzme 토큰을 유저 지갑으로 전송
7. 트랜잭션 결과 및 내역을 DB에 기록

---

## 🛡️ 제약 및 정책

- 1일 최대 스왑 한도(정책 적용 가능)
- 대량 전환 시 관리자 승인 기능(옵션)
- 서버 지갑은 MPC 또는 하드웨어 지갑 등 안전하게 관리
- 스왑 수수료(gas fee)는 프로젝트 부담 또는 별도 UX 설계
- 스왑 요청은 Job Queue/CRON 등으로 분산 처리

---

## ✅ 저장 위치 및 흐름

- 포인트 정보: `user_rewards` 또는 `users` 테이블
- 스왑 요청/내역: `swap_requests`, `swap_transactions` 테이블
- 트랜잭션 해시, 포인트 차감, 토큰 전송 내역 등 기록

---

## 🧾 참고사항

- Payzme 토큰은 이미 배포된 ERC-20 컨트랙트 사용
- 스왑 시 에어드랍/마일리지 보너스 등 확장 가능
- KYC 여부, 카드 연동 등 추가 정책은 별도 문서 참고
- Batch 전송, 승인 절차 등 운영 효율화 고려

---
